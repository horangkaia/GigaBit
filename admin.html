<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>AutoPCare Admin (Firebase Blaze)</title>
<style>
  body{background:#0e0e0e;color:#fff;font-family:Arial;padding:24px}
  .card{background:rgba(255,255,255,0.06);padding:14px;border-radius:10px;width:900px;max-width:95%;margin:auto}
  input,select,button{padding:10px;border-radius:8px;margin-top:8px;width:100%;box-sizing:border-box}
  button{background:#27ae60;color:#fff;border:none;font-weight:700;cursor:pointer}
  .muted{color:#9fb;font-size:13px;margin-top:8px}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.06);font-size:13px;vertical-align:top}
  .danger{background:#c0392b}
  .btn-inline{ padding:6px 10px; margin:2px; border-radius:6px; background:#3498db; border:none; cursor:pointer; color:#fff }
  .danger{background:#c0392b}
  .small{font-size:12px;color:#aaa}
  .row{display:flex;gap:10px}
</style>
</head>
<body>

<div class="card">
  <h2>AutoPCare Admin â€” Firebase Blaze</h2>

  <input id="pw" type="kalikiben" placeholder="Owner password (required)">
  <div class="row">
    <div>
      <label>Tipe license</label>
      <select id="type"><option value="single">single</option><option value="global">global</option></select>
    </div>
    <div>
      <label>Durasi</label>
      <select id="days"><option value="30">30 hari</option><option value="180">180 hari</option><option value="365">365 hari</option></select>
    </div>
  </div>

  <label>HWID</label>
  <input id="hwid" placeholder="*">

  <button id="btnGen">Generate Key</button>

  <pre id="out"></pre>
  <button id="btnList">List Keys</button>

  <div id="table"></div>
</div>

<script>
const OWNER_PW = "kalikiben"; // wajib sama
const DB = "https://schesakra-default-rtdb.asia-southeast1.firebasedatabase.app/autopcare_keys";

// simple auth check
function auth() {
  const pw = document.getElementById("pw").value.trim();
  return pw === OWNER_PW;
}

function randKey() {
  return "KEY-" + Math.random().toString(36).substring(2).toUpperCase();
}

document.getElementById("btnGen").onclick = async () => {
  if (!auth()) return alert("Password salah!");

  const type = type.value;
  const days = Number(document.getElementById("days").value);
  const hwid = document.getElementById("hwid").value.trim() || "*";

  const id = Date.now().toString();
  const key = randKey();
  
  const issued = Date.now();
  const expires = issued + days * 86400000;

  const data = {
    id, key, type, days, hwid,
    paid:false, used:false, revoked:false,
    issued, expires
  };

  await fetch(`${DB}/${id}.json`, {
    method:"PUT",
    body:JSON.stringify(data)
  });

  out.textContent = JSON.stringify(data, null, 2);
};

document.getElementById("btnList").onclick = async () => {
  if (!auth()) return alert("Password salah!");

  const res = await fetch(DB + ".json");
  const list = await res.json();

  if (!list) return (table.innerHTML = "<p>Empty</p>");

  let html = `<table><tr>
      <th>ID</th><th>KEY</th><th>TYPE</th><th>PAID</th>
      <th>USED</th><th>REVOKE</th><th>ACTION</th>
  </tr>`;

  Object.values(list).reverse().forEach(k => {
    html += `
    <tr>
      <td>${k.id}</td>
      <td>${k.key}</td>
      <td>${k.type}/${k.days}</td>
      <td>${k.paid}</td>
      <td>${k.used}</td>
      <td>${k.revoked}</td>
      <td>
        <button class="btn-inline" onclick="markPaid('${k.id}')">Paid</button>
        <button class="btn-inline" onclick="markUsed('${k.id}')">Used</button>
        <button class="btn-inline danger" onclick="revoke('${k.id}')">Revoke</button>
      </td>
    </tr>`;
  });

  html += "</table>";
  table.innerHTML = html;
};

async function markPaid(id){
  if (!auth()) return alert("Pass salah");
  await fetch(`${DB}/${id}/paid.json`, {method:"PUT",body:true});
  alert("Marked Paid"); btnList.click();
}

async function markUsed(id){
  if (!auth()) return alert("Pass salah");
  await fetch(`${DB}/${id}/used.json`, {method:"PUT",body:true});
  alert("Marked Used"); btnList.click();
}

async function revoke(id){
  if (!auth()) return alert("Pass salah");
  await fetch(`${DB}/${id}/revoked.json`, {method:"PUT",body:true});
  alert("Revoked"); btnList.click();
}
</script>

</body>
</html>
